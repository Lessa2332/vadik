<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR </title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }

        .controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 1000;
        }

        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 40px;
            margin: 0 10px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            min-width: 150px;
        }

        .button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .stop-btn {
            background: #f44336;
        }

        .slots {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 1000;
        }

        .slot {
            display: inline-block;
            width: 80px;
            height: 80px;
            margin: 0 5px;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            background: rgba(0,0,0,0.7);
            overflow: hidden;
        }

        .slot img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .result {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            z-index: 2000;
            display: none;
            border: 2px solid #4CAF50;
        }

        .result-img {
            width: 200px;
            height: 200px;
            margin: 15px 0;
        }

        .result img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .close-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Слоти для відображення масок -->
    <div class="slots">
        <div class="slot">
            <img id="slot1" src="masks/mask1.png" alt="Слот 1">
        </div>
        <div class="slot">
            <img id="slot2" src="masks/mask1.png" alt="Слот 2">
        </div>
        <div class="slot">
            <img id="slot3" src="masks/mask1.png" alt="Слот 3">
        </div>
    </div>

    <!-- Кнопки управління -->
    <div class="controls">
        <button class="button" id="startBtn" onclick="startGame()">
            ▶️ СТАРТ
        </button>
        <button class="button stop-btn" id="stopBtn" onclick="stopGame()" disabled>
            ⏹️ СТОП
        </button>
    </div>

    <!-- Панель результату -->
    <div class="result" id="resultPanel">
        <h3 style="color: #4CAF50; margin: 0 0 15px 0;">Результат</h3>
        <div class="result-img">
            <img id="resultImg" src="" alt="Результат">
        </div>
        <button class="close-btn" onclick="closeResult()">OK</button>
    </div>

    <!-- AR сцена -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" renderer="logarithmicDepthBuffer: true;">
        <!-- Маркер обличчя -->
        <a-marker type="face" id="face-marker">
            <!-- Маска на обличчі -->
            <a-entity id="mask-entity"
                     position="0 0.15 0.05"
                     scale="0.2 0.2 0.2"
                     geometry="primitive: plane"
                     material="src: #mask1; transparent: true; opacity: 1.0">
            </a-entity>
        </a-marker>

        <!-- Камера -->
        <a-entity camera></a-entity>

        <!-- Ассети (PNG файли масок) -->
        <a-assets>
            <img id="mask1" src="masks/mask1.png">
            <img id="mask2" src="masks/mask2.png">
            <img id="mask3" src="masks/mask3.png">
            <img id="mask4" src="masks/mask4.png">
            <img id="mask5" src="masks/mask5.png">
        </a-assets>
    </a-scene>

    <script>
        // Маски (PNG файли)
        const masks = ['mask1', 'mask2', 'mask3', 'mask4', 'mask5'];
        
        // Стан гри
        let gameState = {
            isSpinning: false,
            currentMask: 'mask1',
            spinInterval: null,
            finalMask: null,
            slotIntervals: []
        };

        // Початкова настройка
        window.addEventListener('DOMContentLoaded', () => {
            // Встановлюємо першу маску
            setMask('mask1');
            
            // Налаштовуємо слоти
            const defaultImg = document.getElementById('mask1').src;
            ['slot1', 'slot2', 'slot3'].forEach(slotId => {
                document.getElementById(slotId).src = defaultImg;
            });
            
            // Налаштовуємо клавіатуру
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    if (gameState.isSpinning) {
                        stopGame();
                    } else {
                        startGame();
                    }
                }
            });
        });

        // Початок гри
        function startGame() {
            if (gameState.isSpinning) return;
            
            gameState.isSpinning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            // Запускаємо зміну масок
            gameState.spinInterval = setInterval(changeMask, 100);
            
            // Запускаємо слоти
            startSlots();
        }

        // Зупинка гри
        function stopGame() {
            if (!gameState.isSpinning) return;
            
            gameState.isSpinning = false;
            clearInterval(gameState.spinInterval);
            
            // Обираємо фінальну маску
            const randomMask = masks[Math.floor(Math.random() * masks.length)];
            gameState.finalMask = randomMask;
            
            // Встановлюємо маску
            setMask(randomMask);
            
            // Зупиняємо слоти
            stopSlots(randomMask);
            
            // Кнопки
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            // Показуємо результат
            showResult(randomMask);
        }

        // Зміна маски
        function changeMask() {
            if (!gameState.isSpinning) return;
            
            const randomMask = masks[Math.floor(Math.random() * masks.length)];
            gameState.currentMask = randomMask;
            setMask(randomMask);
        }

        // Встановлення маски на обличчя
        function setMask(maskId) {
            const maskEntity = document.getElementById('mask-entity');
            maskEntity.setAttribute('material', 'src', '#' + maskId);
        }

        // Запуск слотів
        function startSlots() {
            // Очищаємо попередні інтервали
            gameState.slotIntervals.forEach(clearInterval);
            gameState.slotIntervals = [];
            
            // Запускаємо нові інтервали
            ['slot1', 'slot2', 'slot3'].forEach((slotId, index) => {
                const interval = setInterval(() => {
                    const randomMask = masks[Math.floor(Math.random() * masks.length)];
                    const maskImg = document.getElementById(randomMask);
                    document.getElementById(slotId).src = maskImg.src;
                }, 100 + (index * 50));
                
                gameState.slotIntervals.push(interval);
            });
        }

        // Зупинка слотів
        function stopSlots(finalMask) {
            // Зупиняємо всі інтервали
            gameState.slotIntervals.forEach(clearInterval);
            gameState.slotIntervals = [];
            
            // Встановлюємо фінальну маску в слоти
            const finalImg = document.getElementById(finalMask).src;
            ['slot1', 'slot2', 'slot3'].forEach((slotId, index) => {
                setTimeout(() => {
                    document.getElementById(slotId).src = finalImg;
                }, index * 200);
            });
        }

        // Показ результату
        function showResult(maskId) {
            const resultPanel = document.getElementById('resultPanel');
            const resultImg = document.getElementById('resultImg');
            
            // Встановлюємо зображення результату
            const maskImg = document.getElementById(maskId);
            resultImg.src = maskImg.src;
            
            // Показуємо панель
            resultPanel.style.display = 'block';
        }

        // Закриття результату
        function closeResult() {
            document.getElementById('resultPanel').style.display = 'none';
        }
    </script>
</body>
</html>
